import { Document, Packer, Paragraph, HeadingLevel } from "docx"
import { writeFileSync, mkdirSync } from "fs"
import { join } from "path"

const title = "百团百项项目合作会议纪要"
const content = `会议围绕百团百项项目合作展开，内容涵盖项目合作背景与目标对齐、平台合作方案（包括门户专区建设与合作机制建立）、数据与资源整合（涉及数据处理共享及算力经费安排）、具体任务推进（包含项目上线计划与清单分工）、项目推进计划与分工安排（涉及任务分配、沟通策略、资源协调、技术对接等）以及专区规划与实施等方面，并明确了多项待办行动项。 
 项目合作背景与目标对齐 
 - 双方需对齐信息，确保经信那边与己方沟通内容一致 
 - 项目合作大背景：吉宁书记在调度会上提出要求，将科学数据汇集到市级平台，作为待办事项需落实 
 - 双方共同目标：完成书记交办任务，将相关项目整合到科学智能门户，同时满足各自诉求 
 平台合作方案 
 门户专区建设 
 - 在科学智能门户设立"百团百项"专区，专区内可按项目名称分类 
 - 专区将整合数据、模型、算力等内容，展示星河启智的相关功能 
 - 专区作为双方合作的重要节点，便于领导查看和对外展示 
 合作机制建立 
 - 建议在专区基础上成立专题委员会或成员单位，明确对外输出的合作框架 
 - 双方保持原有数据积分等合作节奏，同时推进新专区的建设与运营 
 - 积分体系需打通，以科学智能为试点，后期计划在医疗领域（如与中山医院合作）推广 
 数据与资源整合 
 数据处理与共享 
 - 项目数据原则上应放到公共服务平台，山董表示额外有价值的数据，对方愿意额外提供支持 
 - 数据预算待定（1万、2万、5万、10万、100万等金额需根据实际数据评估） 
 - 数据安全、商业化考虑、费用需求等问题可随时沟通，己方将尽力协调或上报领导 
 算力与经费安排 
 - 库帕思科学智能门户无重算力储备，相关算力需求可引向上智院 
 - 百团百项经费及兑换的算力可使用对方的算力资源 
 - 双方探讨数据商业化转化及分润机制，可分给课题组或相关方 
 具体任务推进 
 项目上线计划 
 - 共同目标：将一期14个项目（4月底验收）拉到门户专区 
 - 需对项目团队进行动员，明确项目上线的必要性和具体要求 
 - 建议获得刘处支持并参与任务推进，双方可分工负责不同项目的对接 
 项目清单与分工 
 - 需对方提供14个项目的详细清单，以便双方分工对接 
 - 根据项目所属单位和负责人情况，双方发挥各自资源优势进行沟通协调 
 - 交大项目占比较大（约五六个），需重点关注和推进 
 项目推进计划与分工安排 
 任务分配与责任划分 
 - 汤洁负责处理上智院本身相关事务 
 - 汤洁负责对接创智学院，探索与各学院双聘教师的合作可能性 
 - 库帕思负责对接交大，因复旦背景原因由其对接更合适 
 - 双方分头行动，根据关系亲疏先进行初步沟通，同时推进相关工作 
 工作目标与时间节点 
 - 目标：至少在11月中旬前获取各方初步意愿 
 - 要求：优先争取主动积极参与的合作方，避免"摁头"式合作 
 合作方沟通策略与需求摸底 
 - 沟通重点内容 
   - 了解对方是否愿意参与合作 
   - 明确对方在何种情况下愿意参与 
   - 摸清对方的具体诉求 
   - 基于摸底情况进行后续磨合与协商 
 - 合作吸引策略 
   - 针对关系好的合作方采取"必须来"的策略 
   - 对其他潜在合作方考虑采用"诱惑"策略，如提供补贴等激励措施 
 资源协调与利益分配 
 - 补贴与资源支持 
   - 提议双方各自动员资源，争取提供一些补贴以吸引合作方 
   - 考虑让库帕思方面提供资金支持或"出血"，尽管其之前已提供过百分百降费优惠 
   - 探讨经信帮助双方"创收"的可能性，通过将两三个有影响力的项目纳入提升整体影响力 
 - 成本与投入考量 
   - 现阶段对区块链技术采取谨慎态度，认为其投入大且与当前体量可能不成正比 
   - 建议对外宣传使用区块链概念，实际操作中可暂时搁置，双方先做好记账工作 
   - 优先确保完成"百分百上"的目标，再考虑后续技术投入 
 技术对接与平台建设 
 - 账户与资源互通 
   - 计划先实现双方账户打通，确保用户名等基础信息对齐 
   - 参考之前轻度资源互通的经验，推进更深层次的对接 
   - 负责科学智能门户的产品团队已开展相关工作 
 - 专区建设与验收 
   - 优先建设专区，确保面上能展示项目数量、进展和使用情况 
   - 技术对接会后续将专门召开，讨论具体技术细节 
   - 现阶段验收不要求必须上区块链，先确保在门户上正常运行展示 
 前期工作安排 
 - 信息摸排任务 
   - 安排专人负责摸清百度百项企业的具体情况 
   - 向国义方面咨询评审机制的相关信息 
 - 人员组织 
   - 双方各自列出可参与项目的人员名单，组建专项小组 
   - 无需安排领导双方见面，先由小组推进工作 
 专区规划与实施 
 - 专区设计与实施 
   - 启动专区规划工作，采用轻量化设计方案 
   - 先设计UI界面，内部启动开发，后续输出排期计划 
   - 采用项目制展示形式，先设计假数据占位，后续替换为真实项目 
   - 专区设计完成后先内部审核，再提交魏丽查看后上线 
 - 时间节点安排 
   - 专区建设需赶在维里结项前完成，整体原则为"越快越好" 
   - 若经信委信息收集顺利，争取下周确定大的节点计划 
 具体任务分工 
 - 汤洁负责事项 
   - 发送触达分工表 
   - 申请上智院内部补贴及积分政策，吸引相关单位参与 
   - 与经信对接，布置配合任务 
 - 共同推进事项 
   - 讨论评审问题解决方案 
   - 确定技术对接时间节点及门户专区样式 
   - 规划"百团百项"专区的交互设计与打通方案 
 技术对接安排 
 - 账户打通方案 
   - 前期采用留痕跳转方式实现轻量化对接 
   - 后续讨论资产/项目导入方案，计划下周召开技术会议 
 - 开发启动 
   - 门户专区设计工作立即启动 
   - 账户打通技术对接可适当延后，先完成UI设计 
 行动项 
 [] 提供一期14个项目的详细清单 
 [] 在科学智能门户设立"百人百项"专区 
 [] 明确"百人百项"专区的积分转换机制 
 [] 制定14个项目上线门户的动员计划 
 [] 双方讨论并确定数据商业化分润方案 
 [] 双方分头行动，根据关系亲疏与相关方进行初步沟通 
 [] 汤洁负责处理上志愿本身事务及对接创智学院 
 [] 库帕思团队负责对接交大 
 [] 双方各自动员资源，争取提供补贴以吸引合作方 
 [] 探讨让库帕思方面提供资金支持的可能性 
 [] 推进双方账户打通工作，确保用户名等基础信息对齐 
 [] 建设专区，确保能展示项目数量、进展和使用情况 
 [] 后续召开专门的技术对接会讨论具体技术细节 
 [] 制作项目推进备忘文件 
 [] 今天内完成触达分工表 
 [] 设计专区UI界面并启动内部开发 
 [] 下周安排技术会议讨论资产/项目导入方案 
 [] 约见金老师了解经信委项目流程及节点信息 
 [] 向领导申请补贴及积分政策支持 
 [] 双方整理参与人员名单并组建专项小组 
`

const lines = content.split(/\r?\n/)
const paras: Paragraph[] = []
paras.push(new Paragraph({ text: title, heading: HeadingLevel.TITLE }))
for (const raw of lines) {
  const line = raw.trimEnd()
  if (!line.trim()) {
    paras.push(new Paragraph({ text: "" }))
    continue
  }
  const isBullet = /^- /.test(line) || /^-/.test(line) || /^\\[\\]/.test(line)
  const isHeading = !isBullet && line.length <= 30
  if (isHeading) {
    paras.push(new Paragraph({ text: line.trim(), heading: HeadingLevel.HEADING_2 }))
  } else if (isBullet) {
    const text = line.replace(/^-\\s*/, "").trim()
    paras.push(new Paragraph({ text, bullet: { level: 0 } }))
  } else {
    paras.push(new Paragraph({ text: line }))
  }
}

const doc = new Document({ sections: [{ children: paras }] })
const outDir = join(process.cwd(), "documents")
mkdirSync(outDir, { recursive: true })
const outPath = join(outDir, "百团百项会议纪要.docx")
Packer.toBuffer(doc).then((buffer) => {
  writeFileSync(outPath, buffer)
  process.stdout.write(outPath)
})
